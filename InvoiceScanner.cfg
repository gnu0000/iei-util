#
# Invoice scanner tests
#
# InvoiceScanner.pl is a utility to look at invoice xml files (or db records)
# and search for invoices that match a certain criteria. For example you can
# have a test that answers: "list Group invoices that have a past due > $1000"
#
# This file defines all the test cases that are scanned for by InvoiceScanner.
#
# A test is of the form:
# [testname]
#   options
#
# Where testname is the name of the test.
# options are:
#   label: text ....................... Text to print as heading for the output
#
#   match: xpath ...................... An xpath expression to apply to the invoice xml.
#                                       It is true if there are any matches.
#
#   match: xpath , operator , value .. Expression must pass to be included in the output set
#      where:
#         xpath ........ path to node / nodeval
#         operator ..... what is the compare operator
#         value ........ what are we comparing to?
#      operator:
#         = ............ xpath result equals value (numeric)
#         < ............ xpath result < value (numeric)
#         > ............ xpath result > value (numeric)
#         ~ ............ xpath result matches a regex (string)
#
#   macro: name = value ............... Define simple string replacement macros for the test.
#                                       use macros by enclosing name in {}
#
#   cond: expression .................. Optional. Normally, all match lines must pass for the invoice to
#                                       be included. For more complicated scenarios, use cond to
#                                       define inclusion. match line values are represented as 'match#'
#      expression operators:
#         match1 ........ A variable representing the first match (defined for each match line starting at 1)
#         () ............ parens
#         ! ............. negate
#         && ............ and
#         || ............ or
#      example:
#         cond: (match1 || !match2) && match3
#
#   show: xpath ....................... Display this field in addition to the invoice#
#
#   sort: xpath ....................... Sort by this field
#
#   maxresults: number ................ Max number of invoices to add to the results
#
#   ignore: 0 or 1 .................... Ignore this test if 1
#
# [global] - in addition to the tests, there is a special global section where you
# can define macro's that are available for all tests. macros may be nested up to 10 levels
#
# All matches for a test must pass for the invoice to pass a test unless cond: is used
#
# All possible values for //DocumentInfo/@DocumentTemplate:
#   GeorgiaGroupInvoice                   TexasGroupInvoice
#   GeorgiaIndividualBudgetInvoice        TexasIndividualInvoice
#   GeorgiaIndividualInvoice              TexasIndividualLevelInvoice
#   GeorgiaInfiniteAdvanceInvoice         VeteranGroupInvoice
#   GeorgiaTierIndividualInvoice          VeteranIndividualInvoice
#   FloridaIndividualInvoice              VeteranIndividualLevelInvoice
#   FloridaGroupInvoice
#
# All tests (that don't have -ignore=1) are run unless the user specifies the test with the -test=
# option. If a test is specified on the cmdline it will be run regardless of the -ignore setting.
#
# The following tests are directly mapped from Don's InvoiceTestScenarioMatrix
# https://infiniteenergy.sharepoint.com/:x:/r/sites/TnD/Projects/_layouts/15/guestaccess.aspx?e=Jq4VTA&share=EVJ-vKYrtsNGpf-Fivp_RJsBlb5mQ3CNjrevCACU7P7u5Q#


##############################################################################
#
# Global macros. Available for all test cases
#

[global]
   macro: invoice_ga      = //DocumentInfo/@DocumentTemplate, ~, .*Georgia.*
   macro: ga_individual   = //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   macro: invoice_fl      = //DocumentInfo/@DocumentTemplate, ~, .*Florida.*
   macro: invoice_std     = //DocumentInfo/@DocumentTemplate, ~, .*IndividualInvoice.*
   macro: invoice_advance = //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   macro: invoice_budget  = //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   macro: invoice_group   = //DocumentInfo/@DocumentTemplate, ~, .*Group.*
   macro: cdg_balance     = count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail)
   macro: cdg_supply      = count(//ChargeDetailGroup[@GroupId="2"]/ChargeDetail)
   macro: cdg_adjustments = count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   macro: cdg_estimates   = count(//ChargeDetailGroup[@GroupId="4"]/ChargeDetail)
   macro: cdg_additional  = count(//ChargeDetailGroup[@GroupId="5"]/ChargeDetail)
   macro: cdg_delivery    = count(//ChargeDetailGroup[@GroupId="6"]/ChargeDetail)
   macro: cdg_tax         = count(//ChargeDetailGroup[@GroupId="7"]/ChargeDetail)
   macro: cdg_budget      = count(//ChargeDetailGroup[@GroupId="8"]/ChargeDetail)
   macro: cdg_misc        = count(//ChargeDetailGroup[@GroupId="9"]/ChargeDetail)
   macro: cdg_trash       = count(//ChargeDetailGroup[@GroupId="10"]/ChargeDetail)
   macro: ammt_balance    = //InvoiceAmountSections/BalanceForward/@Amount
   macro: ammt_due        = //InvoiceAmountSections/TotalAmountDue/@Amount
   macro: lc_descr        = translate(@Description, 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz')
   macro: cd_courtesy     = count(//ChargeDetail[contains({lc_descr}, 'courtesy'      )])
   macro: cd_extras       = count(//ChargeDetail[contains({lc_descr}, 'home solutions')])
   macro: cd_credit       = count(//ChargeDetail[contains({lc_descr}, 'credit'        )])
   macro: cd_reversal     = count(//ChargeDetail[contains({lc_descr}, 'reversal'      )])
   macro: cd_adjustment   = count(//ChargeDetail[contains({lc_descr}, 'adjustment'    )])


############################################################################################################################################
#
# top importance tests
#

[101]
   label: Misplaced Charge details - has misc group
   match: count(//ChargeDetailGroup[@GroupId="9"]), >, 0
   show:  //DocumentInfo/@DocumentTemplate
   show:  count(//ChargeDetailGroup[@GroupId="9"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 20
   ignore: 0

[102]
   label: Standard Invoice with Adjustments group
   match: //DocumentInfo/@DocumentTemplate, ~, IndividualInvoice
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[103]
   label: Standard Invoice with Estimate group
   match: //DocumentInfo/@DocumentTemplate, ~, IndividualInvoice
   match: count(//ChargeDetailGroup[@GroupId="4"]/ChargeDetail), >, 0
   show:  count(//ChargeDetailGroup[@GroupId="4"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[104]
   label: Payment arrangement
   match: //InvoiceAccountInfo/Account/@Standing, ~, PaymentArrangement
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

############################################################################################################################################
#
# GeorgiaIndividualInvoice specific tests
#

[201]
   label: Standard - First invoice, 1 or fewer usage history
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//UsageHistoryDetail), <, 2
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[202]
   label: Standard - First invoice, any rate & has add-on services
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//UsageHistoryDetail), <, 2
   match: count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424]), >, 0
   show:  count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[203]
   label: Standard - Not first invoice, previous bill paid in full
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, =, 0
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[204]
   label: Standard - Not first invoice, partial balance of < $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 0
   match: //InvoiceAmountSections/BalanceForward/@Amount, <, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[205]
   label: Standard - Not first invoice, partial balance of > $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[206]
   label: Standard - Not first invoice, full balance carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/PaymentsReceived/@Amount, =, 0
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[207]
   label: Standard -  Payment arrangement installment present
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: //InvoiceAccountInfo/Account/@Standing, ~, PaymentArrangement
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[208]
   label: Standard - Invoice for tiered rate
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaTierIndividualInvoice
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[209]
   label: Standard - Invoice with adjustments
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   sort:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[210]
   label: Standard - Invoice with multiple meter reads
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge), >, 1
   sort:  count(//ConstituentAccounts/Account/Charge)
   show:  count(//ConstituentAccounts/Account/Charge)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[211]
   label: Standard - Invoice with cancelled meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"]), >, 0
   sort:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[212]
   label: Standard - Invoice with initial meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[213]
   label: Standard - Invoice with final meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

############################################################################################################################################
#
# InfiniteAdvance specific tests
#

[301]
   label: Infinite Advance - First invoice
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
#  match: count(//UsageHistoryDetail), <, 2
   match: //ChargeDetail[@Description="Initial estimate"]
   show:  count(//UsageHistoryDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[302]
   label: Infinite Advance - First invoice & add-on services
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
#  match: count(//UsageHistoryDetail), <, 2
   match: //ChargeDetail[@Description="Initial estimate"]
   match: count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424]), >, 0
   show:  count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[303]
   label: Infinite Advance - Not first invoice, previous bill paid in full
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, =, 0
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[304]
   label: Infinite Advance - Not first invoice, partial balance of < $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 0
   match: //InvoiceAmountSections/BalanceForward/@Amount, <, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[305]
   label: Infinite Advance - Not first invoice, partial balance of > $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[306]
   label: Infinite Advance - Not first invoice, full balance carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/PaymentsReceived/@Amount, =, 0
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[307]
   label: Infinite Advance - First bill generated after moving to Standard billing
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[308]
   label: Infinite Advance - First bill generated after moving to Budget billing
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[309]
   label: Infinite Advance - Payment arrangement installment present
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: //InvoiceAccountInfo/Account/@Standing, ~, PaymentArrangement
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[310]
   label: Infinite Advance - Invoice with adjustments
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[311]
   label: Infinite Advance - Invoice with >3 adjustment charges
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 3
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[312]
   label: Infinite Advance - Invoice with <3 adjustment charges
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), <, 3
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[313]
   label: Infinite Advance - Invoice with multiple meter reads
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ConstituentAccounts/Account/Charge), >, 1
   show:  count(//ConstituentAccounts/Account/Charge)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[314]
   label: Infinite Advance - Invoice with cancelled meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"]), >, 0
   sort:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[315]
   label: Infinite Advance - Invoice with initial meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[316]
   label: Infinite Advance - Invoice with final meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[317]
   label: Infinite Advance - Adjustments Section is negative
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]), >, 0
   match: //ChargeDetailGroup[@GroupId="3"]/@Amount, <, 0
   show:  //ChargeDetailGroup[@GroupId="3"]/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[318]
   label: Infinite Advance - Has Account setup fee & adjustment section
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]), >, 0
   match: count(//ChargeDetail[contains({lc_descr}, 'setup fee')]), > , 0
   show:  //ChargeDetailGroup[@GroupId="3"]/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

############################################################################################################################################
#
# IndividualBudget specific tests
#

[401]
   label: Budget Billing - First invoice, not on a bundled hardware (Google) rate
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//UsageHistoryDetail), <, 2
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[402]
   label: Budget Billing - First invoice, on a bundled hardware (Google) rate
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//UsageHistoryDetail), <, 2
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[403]
   label: Budget Billing - First invoice, any rate & has add-on services
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//UsageHistoryDetail), <, 2
   match: count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424]), >, 0
   show:  count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[404]
   label: Budget Billing - Not first invoice, previous bill paid in full
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@LevelAmount, =, 0
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[405]
   label: Budget Billing - Not first invoice, partial balance of < $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@LevelAmount, >, 0
   match: //InvoiceAmountSections/BalanceForward/@LevelAmount, <, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@LevelAmount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[406]
   label: Budget Billing - Not first invoice, partial balance of > $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@LevelAmount, >, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@LevelAmount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[407]
   label: Budget Billing - Not first invoice, full balance carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/PaymentsReceived/@Amount, =, 0
   show:  //InvoiceAmountSections/BalanceForward/@LevelAmount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[408]
   label: Budget Billing - First bill generated after moving to Standard billing
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[409]
   label: Budget Billing - First bill generated after moving to Budget billing
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[410]
   label: Budget Billing - Payment arrangement installment present
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: //InvoiceAccountInfo/Account/@Standing, ~, PaymentArrangement
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[411]
   label: Budget Billing - Invoice with adjustments
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   sort:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[412]
   label: Budget Billing - Invoice with multiple meter reads
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//ConstituentAccounts/Account/Charge), >, 1
   show:  count(//ConstituentAccounts/Account/Charge)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[413]
   label: Budget Billing - Invoice with cancelled meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"]), >, 0
   sort:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[414]
   label: Budget Billing - Invoice with initial meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[415]
   label: Budget Billing - Invoice with final meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[416]
   label: Budget Billing - First invoice after plan reconciliation
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[417]
   label: Budget invoices with Additional services
   match: {invoice_budget}
   match: {cdg_additional}, >, 0
   show: {cdg_additional}
   show:  //InvoiceDetails/@BillDate
   maxresults: 50
   ignore: 0

[418]
   label: Budget invoices with Additional budget charges
   match: {invoice_budget}
   match: {cdg_budget}, >, 1
   show:  {cdg_budget}
   show:  //InvoiceDetails/@BillDate
   maxresults: 50
   ignore: 0

[419]
   label: Budget invoices with Deposit application
   match: {invoice_budget}
   match: count(//ChargeDetail[contains({lc_descr}, 'deposit application')]), >, 0
   show:  //InvoiceDetails/@BillDate
   maxresults: 50
   ignore: 0


############################################################################################################################################
#
#  FloridaIndividualInvoice specific tests
#

[501]
   label: FL Standard - First invoice, not on a bundled hardware (Google) rate
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//UsageHistoryDetail), <, 2
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[502]
   label: FL Standard - First invoice, on a bundled hardware (Google) rate
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//UsageHistoryDetail), <, 2
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[503]
   label: FL Standard - First invoice, any rate & has add-on services
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//UsageHistoryDetail), <, 2
   match: count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424]), >, 0
   show:  count(//ChargeDetailGroup/ChargeDetail[@SetId > 400 and @SetId < 424])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[504]
   label: FL Standard - Not first invoice, previous bill paid in full
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, =, 0
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[505]
   label: FL Standard - Not first invoice, partial balance of < $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 0
   match: //InvoiceAmountSections/BalanceForward/@Amount, <, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[506]
   label: FL Standard - Not first invoice, partial balance of > $30 carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 30.00
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[507]
   label: FL Standard - Not first invoice, full balance carried over from previous bill
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//UsageHistoryDetail), >, 1
   match: //InvoiceAmountSections/PaymentsReceived/@Amount, =, 0
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[508]
   label: FL Standard -  Payment arrangement installment present
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: //InvoiceAccountInfo/Account/@Standing, ~, PaymentArrangement
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[509]
   label: FL Standard - Invoice for tiered rate
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaTierIndividualInvoice
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[510]
   label: FL Standard - Invoice with adjustments
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   sort:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[511]
   label: FL Standard - Invoice with multiple meter reads
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge), >, 1
   sort:  count(//ConstituentAccounts/Account/Charge)
   show:  count(//ConstituentAccounts/Account/Charge)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[512]
   label: FL Standard - Invoice with cancelled meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"]), >, 0
   sort:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[513]
   label: FL Standard - Invoice with initial meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Initial"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[514]
   label: FL Standard - Invoice with final meter read(s)
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[515]
   label: FL Standard - With courtesy charges
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ChargeDetail[contains({lc_descr}, 'courtesy')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'courtesy')])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[516]
   label: FL Standard - Invoice with Delivery section
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ChargeDetailGroup[@GroupId="6"]/ChargeDetail), >, 0
   show:  count(//ChargeDetailGroup[@GroupId="6"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[517]
   label: FL Standard - Invoice with Transportation Charges (170 & 171)
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: count(//ChargeDetailGroup/ChargeDetail[@SetId > "169" and @SetId < "172"]), >, 0
   show:  count(//ChargeDetailGroup/ChargeDetail[@SetId > "169" and @SetId < "172"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[518]
   label: FL Standard - positive balance forward, but not past due
   match: //DocumentInfo/@DocumentTemplate, ~, FloridaIndividualInvoice
   match: //InvoiceAccountInfo/Account/@Standing, ~, Good
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 0
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0


############################################################################################################################################
#
# Courtesy charges tests
#

[601]
   label: Standard - With courtesy charges
   match: //DocumentInfo/@DocumentTemplate, ~, IndividualInvoice
   match: count(//ChargeDetail[contains({lc_descr}, 'courtesy')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'courtesy')])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[602]
   label: Infinite Advance - With courtesy charges
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetail[contains({lc_descr}, 'courtesy')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'courtesy')])
   show:  //ChargeDetail[contains({lc_descr}, 'courtesy')][1]/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[603]
   label: Budget Billing - With courtesy charges
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//ChargeDetail[contains({lc_descr}, 'courtesy')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'courtesy')])
   show:  //ChargeDetail[contains({lc_descr}, 'courtesy')][1]/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

############################################################################################################################################
#
# Negative amount due tests
#

[604]
   label: Standard - Negative Amount due
   match: //DocumentInfo/@DocumentTemplate, ~, IndividualInvoice
   match: //InvoiceAmountSections/TotalAmountDue/@Amount, <, 0
   sort:  -//InvoiceAmountSections/TotalAmountDue/@Amount
   show:  //InvoiceAmountSections/TotalAmountDue/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[605]
   label: Infinite Advance - Negative Amount due
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: //InvoiceAmountSections/TotalAmountDue/@Amount, <, 0
   sort:  -//InvoiceAmountSections/TotalAmountDue/@Amount
   show:  //InvoiceAmountSections/TotalAmountDue/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[606]
   label: Budget Billing - Negative Amount due
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: //InvoiceAmountSections/TotalAmountDue/@LevelAmount, <, 0
   sort:  -//InvoiceAmountSections/TotalAmountDue/@LevelAmount
   show:  //InvoiceAmountSections/TotalAmountDue/@LevelAmount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

############################################################################################################################################
#
# Extra charges in the balance forward group
#

[607]
   label: Standard - Extra stuff in the balance forward group
   match: //DocumentInfo/@DocumentTemplate, ~, IndividualInvoice
   match: count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail), >, 2
   sort:  count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail)
   show:  count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[608]
   label: Infinite Advance - Extra stuff in the balance forward group
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail), >, 2
   sort:  count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail)
   show:  count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[609]
   label: Budget Billing - Extra stuff in the balance forward group
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   match: count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail), >, 3
   sort:  count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail)
   show:  count(//ChargeDetailGroup[@GroupId="1"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

############################################################################################################################################
#
# Credits, Reversals, Adjustments
#

[610]
   label: Has Credit charges
   match: count(//ChargeDetail[contains({lc_descr}, 'credit')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'credit')])
   show:  //DocumentInfo/@DocumentTemplate
   show:  //ChargeDetail[contains({lc_descr}, 'credit')]/@Amount
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   ignore: 0
   maxresults: 10

[611]
   label: Has Reversal charges
   match: count(//ChargeDetail[contains({lc_descr}, 'reversal')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'reversal')])
   show:  //DocumentInfo/@DocumentTemplate
   ignore: 0
   maxresults: 10

[612]
   label: Has Adjustment charges
   match: count(//ChargeDetail[contains({lc_descr}, 'adjustment')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'adjustment')])
   show:  //DocumentInfo/@DocumentTemplate
   ignore: 0
   maxresults: 10

############################################################################################################################################
#
# Base Charge anomalies
#

[613]
   label: Multiple base charges
   match: count(//ChargeDetail[@SetId="128"]), >, 1
   sort:  count(//ChargeDetail[@SetId="128"])
   show:  count(//ChargeDetail[@SetId="128"])
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[614]
   label: No base charges
   match: count(//ChargeDetail[@SetId="128"]), =, 0
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

############################################################################################################################################
#
# Meter read tests
#

[615]
   label: Meter Read with ReadSource=Final
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Final"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[616]
   label: Meter Read with ReadSource=Cancelled
   match: count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@ReadSource="Cancelled"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[617]
   label: Meter Read with PreviousReadSource=Final
   match: count(//ConstituentAccounts/Account/Charge[@PreviousReadSource="Final"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@PreviousReadSource="Final"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

[618]
   label: Meter Read with PreviousReadAmount=Cancelled
   match: count(//ConstituentAccounts/Account/Charge[@PreviousReadAmount="Cancelled"]), >, 0
   show:  count(//ConstituentAccounts/Account/Charge[@PreviousReadAmount="Cancelled"])
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

############################################################################################################################################
#
# various tests
#

[701]
   label: Has "Initial estimate" charge
   match: //ChargeDetail[@Description="Initial estimate"]
   show:  count(//UsageHistoryDetail)
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[702]
   label: Has DDDC adder charges
   match: //ChargeDetail[@SetId="131"]
   sort: //ChargeDetail[@SetId="131"]/@Amount
   show:  //ChargeDetail[@SetId="131"]/@Amount
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[703]
   label: Has setup fees
   match: //ChargeDetail[@SetId="164"]
   sort:  //ChargeDetail[@SetId="164"]/@Amount
   show:  //ChargeDetail[@SetId="164"]/@Amount
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[704]
   label: Has deposit due
   match: //DepositDue/@Amount, >, 0
   sort:  //DepositDue/@Amount
   show:  //DepositDue/@Amount
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[705]
   label: Has City of Calhoun charges
   match: count(//ChargeDetail[contains({lc_descr}, 'calhoun')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'calhoun')])
   maxresults: 5
   ignore: 0

[706]
   label: Accounts with Late fees
   match: count(//ChargeDetail[contains({lc_descr}, 'late fee')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'late fee')])
   show:  //DocumentInfo/@DocumentTemplate
   ignore: 0
   maxresults: 5

[707]
   label: Has Home Solutions charges
   match: count(//ChargeDetail[contains({lc_descr}, 'home solutions')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, '')])
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   maxresults: 5
   ignore: 0

[708]
   label: Has "Tax on: ..." charges
   match: count(//ChargeDetail[contains({lc_descr}, 'tax on:')]), > , 0
   show:  count(//ChargeDetail[contains({lc_descr}, 'tax on:')])
   ignore: 0
   maxresults: 5

[709]
   label: Uses Alternate ID for DDDC adder charges
   match: //ChargeDetail[@SetId="132"]
   sort:  //ChargeDetail[@SetId="132"]/@Amount
   show:  count(//ChargeDetail[@SetId="132"]/@Amount)
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[710]
   label: Has SetId 163 (?)
   match: count(//ChargeDetailGroup/ChargeDetail[@SetId=63]), >, 0
   show:  //DocumentInfo/@DocumentTemplate
   show:  //ChargeDetailGroup/ChargeDetail[@SetId=63]/@Description
   maxresults: 5
   ignore: 1

[711]
   label: Has "Activation fee/assessment" in Adjustments group
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail[@SetId="106"]), > , 0
   show:  //DocumentInfo/@DocumentTemplate
   maxresults: 5
   ignore: 0

[712]
   label: Infinite Advance - Has "Activation fee/assessment" in Taxes group
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="7"]/ChargeDetail[@SetId="106"]), > , 0
   show:  //DocumentInfo/@DocumentTemplate
   maxresults: 5
   ignore: 0

[713]
   label: Has "Account setup fee"
   match: count(//ChargeDetail[@SetId="164"]), > , 0
   show:  //DocumentInfo/@DocumentTemplate
   maxresults: 5
   ignore: 0

[714]
   label: Has pass-thru charges
   match: count(//Message[contains({lc_descr}, 'pass through charges')]), > , 0
   show:  count(//Message[contains({lc_descr}, 'pass through charges')])
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[715]
   label: Has budget misc or trash group
   match: {cdg_budget}, >, 0
   match: {cdg_misc}, >, 0
   match: {cdg_trash}, >, 0
   cond:  match1 || match2 || match3
   show:  {cdg_budget}
   show:  {cdg_misc}
   show:  {cdg_trash}
   maxresults: 15
   ignore: 0

############################################################################################################################################
#
# Lesser importance tests - general information
#

[801]
   label: Invoices with many charge details
   sort:  count(//ChargeDetail)
   show:  count(//ChargeDetail)
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[802]
   label: Invoices with few charge details
   sort:  -count(//ChargeDetail)
   show:  count(//ChargeDetail)
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[803]
   label: Invoice with N/A for duedate
   match: InvoiceDetails/@DueDate, ~, N/A
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 0

[804]
   label: Previous bill is not past due
   match: //Message[contains(@Type, "LastDueDatePassed")]/@Description, ~ , False
   show:  //Message[@Type = "LastDueDate"]/@Description
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   ignore: 0
   maxresults: 5

# ----- debug test -----
[805]
   label: Previous bill is not past due - labeled show
   match: //Message[contains(@Type, "LastDueDatePassed")]/@Description, ~ , False
   show:  LastDueDate: //Message[@Type = "LastDueDate"]/@Description
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   ignore: 1
   maxresults: 5

[806]
   label: Past due ammt and message
   match: //InvoiceAmountSections/BalanceForward/@Amount, >, 0
   match: count(//Message[contains({lc_descr}, 'you have a past-due balance')]), > , 0
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  ////Message/@Description
   maxresults: 10
   ignore: 1

[807]
   label: Has Late Fee charges
   match: count(//ChargeDetail[@SetId="97"]), > , 0
   show:  //DocumentInfo/@DocumentTemplate
   show:  count(//ChargeDetail[@SetId="97"])
   maxresults: 5
   ignore: 0

[808]
   label: Has autopay message
   match: count(//Message[contains({lc_descr}, 'your payment will be processed automatically on')]), > , 0
   show:  //DocumentInfo/@DocumentTemplate
   maxresults: 5
   ignore: 0

[809]
   label: Standard - TotalAmountDue=0 & BalanceForward=0
   match: //InvoiceAmountSections/TotalAmountDue/@Amount, =, 0
   match: //InvoiceAmountSections/BalanceForward/@Amount, =, 0
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 0

#####################################################################
#
# The tests below are normally ignored. To invoke them, use the
#   explicit -test param. for example:
#     InvoiceScanner.pl -test:Prepay -test:31 xml-11-27\*.xml
#

[810]
   label: Count of IA Accounts
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   show:  //InvoiceDetails/@BillDate
   show:  //DocumentInfo/@DocumentGeneratedDate
   show:  //Onsert/@value
   ignore: 1

[811]
   label: Count if IA Accounts with Onsert
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: //Onsert/@value, ~, How_To_Read
   show:  //InvoiceDetails/@BillDate
   ignore: 1

[812]
   label: InfiniteAdvance accts info
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   show:  //InvoiceAccountInfo/Account/@AccountNumber
   show:  //InvoiceAccountInfo/Account/@AccountName
   show:  //InvoiceAccountInfo/MailingAddress/@AddressLine1
   show:  //InvoiceAccountInfo/MailingAddress/@AddressLine2
   show:  //InvoiceAccountInfo/MailingAddress/@AddressLine3
   show:  //InvoiceAccountInfo/MailingAddress/@ZipCode
   show:  //InvoiceAccountInfo/Account/@EmailAddress
   ignore: 1

[813]
   label: InfiniteAdvance accts with delivery section
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="6"]/ChargeDetail), >, 0
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[814]
   label: Individual Examples of IndividualInvoice
   match: //DocumentInfo/@DocumentTemplate, ~, GeorgiaIndividualInvoice
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[815]
   label: Prepay Examples of GeorgiaInfiniteAdvanceInvoice
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[816]
   label: budget Examples of GeorgiaIndividualBudgetInvoice
   match: //DocumentInfo/@DocumentTemplate, ~, .*IndividualBudget.*
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[817]
   label: Everything
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceAmountSections/BalanceForward/@Amount
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[818]
   label: messages - invoices with many Messages
   sort:  count(//Message)
   show:  count(//Message)
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[819]
   label: test:messagearea - invoices with many Messages in the message area
   match: //Message[contains(@Location, "Message Area")]
   sort:  count(//Message[contains(@Location, "Message Area")])
   show:  count(//Message[contains(@Location, "Message Area")])
   show:  //DocumentInfo/@DocumentTemplate
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[820]
   label: test:nodate1 Infinite Advance - Invoice with adjustments but no date
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail[starts-with(@Description, " Invoiced")]), >, 0
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1

[821]
   label: test:nodate2 Infinite Advance - Invoice with adjustments but no date
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail[starts-with(@Description, " Gas")]), >, 0
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 1

[822]
   label: test:nodate3 Infinite Advance - Invoice with adjustments but no date
   match: //DocumentInfo/@DocumentTemplate, ~, .*InfiniteAdvance.*
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail), >, 0
   match: count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail[starts-with(@Description, " AGL")]), >, 0
   show:  count(//ChargeDetailGroup[@GroupId="3"]/ChargeDetail)
   show:  //InvoiceDetails/@BillDate
   maxresults: 10
   ignore: 1

[823]
   label: invoice rate codes
   show:  //ContractInfo/@RateCode
   show:  //InvoiceDetails/@BillDate
   ignore: 1

#####################################################################
#
# group specific tests
#
[900]
   label: group invoice: child accounts with adjustments
   match: //DocumentInfo/@DocumentTemplate, ~, .*GeorgiaGroupInvoice.*
   match: //Account/Charge/@AdjustmentAmount, >, 0
   show:  //Account/Charge/@AdjustmentAmount

#####################################################################
#
#  develop - debug
#

[1824]
   label: test:testtest - a test to get generate literals via xpath
   show:  //DocumentInfo/@DocumentTemplate
   show:  count(//DocumentInfo/@DocumentTemplate)
   show:  -count(//DocumentInfo/@DocumentTemplate)
   show:  'bob says hi'
   show:  concat(//DocumentInfo/@DocumentTemplate, ' says fred')
   show:  //InvoiceDetails/@BillDate
   maxresults: 5
   ignore: 1


[1825]
   label: test1: --group 1---
   match: count({cdg_balance}), >, 0
   maxresults: 5
   ignore: 1

[1826]
   label: has (credit | reversal | adjustment) && has a balance
   match: {cd_credit}, >, 0
   match: {cd_reversal}, >, 0
   match: {cd_adjustment}, >, 0
   match: {balance}, >, 0
   match: {balance}, <, 0
   cond:  (match1 || match2 || match3) && (match4 || match5)
   show:  {cd_credit}
   show:  {cd_reversal}
   show:  {cd_adjustment}
   show:  {balance}
   maxresults: 50
   ignore: 1

[1827]
   label: GA Budget with (credit | reversal | adjustment)
   match: {invoice_budget}
   match: {cd_credit}, >, 0
   match: {cd_reversal}, >, 0
   match: {cd_adjustment}, >, 0
   cond:  match1 && (match2 || match3 || match4)
   show:  {cd_credit}
   show:  {cd_reversal}
   show:  {cd_adjustment}
   show:  //InvoiceDetails/@BillDate
   maxresults: 50
   ignore: 1

